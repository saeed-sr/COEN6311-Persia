{% extends 'booking/base.html' %}

{% block title %}View Bookings{% endblock %}

{% block content %}
<div class="container">
    <h2>Your Bookings</h2>
    <div class="row">
        <div class="col-md-6"> 
            <h3>Current Custom Packages</h3>
            {% for custom_package in current_custom_packages %}
                <div class="card mb-3">
                    <div class="card-body">
                        <p>User: {{ custom_package.user.username }}</p>
                        <p>Flights: 
                            {% if custom_package.flights.exists %}
                                {% for flight in custom_package.flights.all %}
                                    {{ flight.airline }} - {{ flight.flight_number }}<br>
                                {% endfor %}
                            {% else %}
                                No flights
                            {% endif %}
                        </p>
                        <p>Hotels: 
                            {% if custom_package.hotels.exists %}
                                {% for hotel in custom_package.hotels.all %}
                                    {{ hotel.name }} in {{ hotel.city }}<br>
                                {% endfor %}
                            {% else %}
                                No hotels
                            {% endif %}
                        </p>
                        <p>Activities: 
                            {% if custom_package.activities.exists %}
                                {% for activity in custom_package.activities.all %}
                                    {{ activity.name }} - {{ activity.location }}<br>
                                {% endfor %}
                            {% else %}
                                No activities
                            {% endif %}
                        </p>
                        <a href="{% url 'complete_booking' custom_package.id %}" class="btn btn-primary">Complete Booking</a>
                        <!-- Add conditional rendering for the reserved status and the Pay Now button -->
                            {% with booking=custom_package.booking_set.first %}
                            {% if booking %}
                                {% if booking.paid %}
                                    <p class="reserved-title" style="color:green;">Complete</p>
                                {% else %}
                                    <p class="reserved-title" style="color:orange;">Reserved</p>
                                    <!-- Add the Pay Now button if the booking is within the reservation time -->
                                    {% if booking.reserved_until >= timezone.now %}
                                        <a href="{% url 'payment' booking.id %}" class="btn btn-success">Pay Now</a>
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endwith %}
                    </div>
                </div>
            {% endfor %}
        </div>

        <div class="col-md-6">
            <h3>Old Bookings</h3>
            {% for old_booking in old_bookings %}
                <div class="card mb-3">
                    <div class="card-body">
                        <!-- Display old bookings -->
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}
